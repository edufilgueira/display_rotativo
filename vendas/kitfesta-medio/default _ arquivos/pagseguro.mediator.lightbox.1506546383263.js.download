(function(){var PagSeguro=PagSeguro||{};PagSeguro.Lightbox=function(){this.application=$("#UolPS-application");this.applicationWrapper=$("#UolPS-application-wrapper");this.lightbox=$("#UolPS-lightbox");this.close=$("#UolPS-application-close-btn");this.closeConfirmation=$("#UolPS-application-close-confirmation");this.loader=$("#UolPS-application-loader");this.loaderMessage=document.querySelector(".application-loader__text");this.transactionCode="";this.vendor=window.parent;this.mediator=new PagSeguro.APIMediator({vendor:this.vendor,application:this.application});this.listenChannels();this.bindEvents()};PagSeguro.Lightbox.prototype={constructor:PagSeguro.Mediator,publish:function(message,channel){this.mediator.postMessage(message,channel)},subscribe:function(channel,callback){this.mediator.acceptMessage(channel,callback)},unsubscribe:function(channel){this.mediator.ignoreMessage(channel)},bindEvents:function(){var _that=this;this.close.on("click",function(e){if(""===_that.transactionCode){_that.closeConfirmation.show()}else{_that.closeApplication()}});this.closeConfirmation.on("click",".close",function(e){_that.closeApplication();_that.closeConfirmation.hide();_that.feLogger("cancelar-compra","closeConfirmation")});this.closeConfirmation.on("click",".continue",function(e){_that.closeConfirmation.hide();_that.feLogger("continuar-compra","closeConfirmation")})},showLoader:function(){this.loader.fadeIn(400)},hideLoader:function(){this.setLoadingMessage("");this.loader.fadeOut(400)},setUserTheme:function(theme){$("body").addClass(theme)},setLoadingMessage:function(message){this.loaderMessage.textContent=message},feLogger:function(msg,method){var i=new Image;i.src="https://pagseguro.uol.com.br/checkout/fe-logger.jhtml?log="+msg+"&jsMethod="+method+"&jsOrigin=pagseguro.mediator.lightbox.js"},closeApplication:function(){var _that=this;if(navigator.userAgent.indexOf("MSIE 8.0")>0){_that.lightbox.css("opacity","0");_that.applicationWrapper.css("opacity","0")}this.applicationWrapper.removeClass("css3-anim-fade-in");this.applicationWrapper.addClass("css3-anim-fade-out");this.application.attr("src","about:blank");setTimeout(function(){_that.lightbox.removeClass("css3-anim-slide-down-fade-in");_that.lightbox.addClass("css3-anim-fade-out");setTimeout(function(){_that.publish({command:"hide"},"vendor")},350)},230)},closeApplicationWindow:function(){var _that=this;if(this.application){this.application.close()}_that.publish({command:"hide"},"vendor")},initApplication:function(){var _that=this;if(navigator.userAgent.indexOf("MSIE 8.0")>0){_that.lightbox.css("opacity","1");_that.applicationWrapper.css("opacity","1")}this.lightbox.addClass("css3-anim-slide-down-fade-in");setTimeout(function(){_that.applicationWrapper.addClass("css3-anim-fade-in")},200)},initApplicationAsWindow:function(url){this.application=window.open(url,"location=no")},initApplicationAsRedir:function(url){this.vendor.location.href=url},getPaymentUrl:function(data){return"https://pagseguro.uol.com.br/checkout/v2/lightbox.html?layout=embedded&checkoutListener=javascript&"+data.value},listenChannels:function(){var _that=this;this.subscribe("vendor",function(data){switch(data.command){case"setToken":if("NEW_WINDOW"==$("input#openTarget").val()){_that.initApplicationAsRedir(_that.getPaymentUrl(data));return}_that.transactionCode="";_that.showLoader();_that.application.attr("src",_that.getPaymentUrl(data));_that.initApplication()}});this.subscribe("application",function(data){switch(data.command){case"setUserTheme":_that.setUserTheme(data.value);break;case"setTransactionCode":_that.transactionCode=data.value;_that.publish({command:"setTransactionCode",value:data.value},"vendor");break;case"setRecoveryCode":_that.publish({command:"setRecoveryCode",value:data.value},"vendor");break;case"setLoadingMessage":_that.setLoadingMessage(data.value);break;case"close":if("NEW_WINDOW"==$("input#openTarget").val()){_that.closeApplicationWindow()}else{_that.closeApplication()}break;case"showLoadedContent":_that.hideLoader();break;case"load":_that.showLoader();break}})}};PagSeguro.APIMediator=function(core){var channels={vendor:{context:core.vendor,url:"null",callbacks:[]},application:{context:core.application,url:"https://pagseguro.uol.com.br",callbacks:[]}};var errors={1:'O checkout não pode estabelecer comunicação com o protocolo "file:///". O protocolor deve ser "http://" ou "https://"',2:"Chave pública não reconhecida"};this.postMessage=function(message,channel){if(channels[channel]){channels[channel].context.postMessage(JSON.stringify(message),channels[channel].url)}};this.acceptMessage=function(channel,callback){var _that=this,callbacks=channels[channel].callbacks;callbacks[callbacks.length]=function(event){var data=JSON.parse(event.data);if("null"==channels.vendor.url){switch(data.command){case"syntonize":channels.vendor.url=data.value;_that.postMessage({command:"ready",value:true,isMobile:"NEW_WINDOW"==$("input#openTarget").val()?true:false},"vendor");break}}if(!channels[channel]){return}if(event.origin==channels[channel].url){callback(data,channels);return}};window[window.addEventListener?"addEventListener":"attachEvent"](window.addEventListener?"message":"onmessage",callbacks[callbacks.length-1],false)};this.ignoreMessage=function(channel){var _that=this,i=channels[channel].callbacks.length;if(channels[channel]){while(i--){window[window.removeEventListener?"removeEventListener":"detachEvent"](window.removeEventListener?"message":"onmessage",channels[channel].callbacks[i],false)}}}};$(function(){new PagSeguro.Lightbox})})();